<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>よまかせへようこそ！</title>
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- 카카오 애드핏 광고 코드 -->
    <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link th:href="@{/css/styles.css}" rel="stylesheet" />
    <!-- google fonts -->
    <!-- 깔끔 가독성 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Noto+Serif+KR:wght@200..900&display=swap" rel="stylesheet">
    <!-- 둥근 귀여운 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <script>
        // selected_day를 설정할 때 한글 및 특수문자 인코딩
        document.cookie = "selected_day=" + encodeURIComponent("Tue Sep 10 2024 00:00:00 GMT+0900 (한국 표준시)");
        // ISO 형식으로 날짜 저장 (예: 2024-09-10T00:00:00+09:00)
        document.cookie = "selected_day=" + new Date().toISOString();
        // 한글 및 불필요한 정보를 제거한 간단한 날짜 형식으로 쿠키 저장
        document.cookie = "selected_day=" + new Date().toUTCString();
    </script>
</head>
<body id="image-container">
<div id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav"  sec:authorize="isAuthenticated()">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">
            <span class="d-block d-lg-none">よまかせ</span>
            <span class="d-none d-lg-block"><img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="/img/logo.png" alt="..." /></span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#myRefrigerator">나의냉장고</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#ingredientInput">재료입력</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#calendar">달력</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#board">게시판</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#myPages">마이페이지</a>
                </li>
            </ul>
        </div>
        <div id="index-footer" style="font-size: 15px; color: white;">
            <span>(주)요마카세<br>이용문의 : T. 02-000-0000</span>
        </div>
    </nav>

    <!-- 광고 오버레이 및 더미 광고 영역 -->
    <div id="ads-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 9999;"></div>
    <div id="dummy-ads-container" style="display: none; border: 1px solid #ddd; padding: 20px; background: #fff; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; text-align: center;">
        <h3>광고</h3>
        <p>이곳은 더미 광고 영역입니다. 실제 광고가 여기 표시될 것입니다.</p>
        <img th:src="@{/img/dummyAd.png}" alt="더미 광고 이미지" style="width: 320px; height: 100px;">
        <!-- 버튼들을 감싸는 컨테이너 -->
        <div class="button-container">
            <button class="ad-button" onclick="closeAd()">광고 닫기</button>
        </div>
    </div>


    <!--=== 본문 부분 ===-->
    <div class="container-fluid p-0">
        <!-- 홈 화면 -->
        <section class="resume-section" id="about">
            <div class="resume-section-content" id="homeContent">
                <div th:insert="~{home :: home}">
                </div>
            </div>
        </section>
        <div sec:authorize="isAuthenticated()">
            <hr class="m-0" />
            <!-- 나의 냉장고 -->
            <section class="resume-section" id="myRefrigerator">
                <div class="resume-section-content">
                    <div th:insert="~{refrigerator :: refrigerator}">
                    </div>
                </div>
            </section>
            <hr class="m-0" />

            <!-- 재료 입력 -->
            <section class="resume-section" id="ingredientInput">
                <div class="resume-section-content">
                    <div th:insert="~{ingredientInput :: ingredientInput}">
                    </div>
                </div>
            </section>
            <hr class="m-0" />
            <!-- 달력 -->
            <section class="resume-section" id="calendar">
                <div class="resume-section-content">
                    <div th:insert="~{calendar :: calendar}">
                    </div>
                </div>
            </section>
            <hr class="m-0" />

            <!-- 게시판 -->
            <section class="resume-section" id="board">
                <div class="resume-section-content">
                    <div th:insert="~{boardListView :: boardListView}">
                    </div>
                </div>
            </section>
            <hr class="m-0" />

            <!-- 마이 페이지 -->
            <section class="resume-section" id="myPages">
                <div class="resume-section-content">
                    <div th:replace="~{myPages :: myPages}">
                    </div>
                </div>
            </section>
        </div>
        <hr class="m-0" />
    </div>
</div>
</body>
<!-- Jquery JS-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>
<!-- JavaScript는 모든 HTML 요소가 렌더링된 후에 실행되도록 body 끝에 위치 -->
<!-- 서버에서 전달된 userRole 값을 담고 있는 숨겨진 input -->
<input type="hidden" id="userRole" name="userRole" th:value="${member?.userRole ?: 'ROLE_GUEST'}">
<script>
    let clickedHref = ""; // 클릭한 링크의 href 값을 저장할 변수

    // 페이지가 로드되면 실행되는 함수 - DOMContentLoaded 이벤트 핸들러
    document.addEventListener('DOMContentLoaded', function() {
        // userRole 값 가져오기
        const userRole = document.getElementById('userRole').value;
        console.log("User Role:", userRole); // userRole 값을 콘솔에 출력 (디버깅용)
        const isUserRole = (userRole === 'ROLE_USER'); // ROLE_USER일 때만 광고를 표시

        // nav-item을 클릭할 때마다 광고를 띄우기 위한 이벤트 설정
        document.querySelectorAll('.nav-item a').forEach(item => {
            item.addEventListener('click', (event) => {
                event.preventDefault(); // 기본 동작 방지
                clickedHref = event.currentTarget.getAttribute('href'); // 클릭한 링크의 href 값 저장
                if (isUserRole) {
                    openAd(); // 광고 영역을 열고 오버레이 표시
                } else {
                    window.location.href = clickedHref; // ROLE_USER가 아니면 바로 이동
                }
            });
        });

        // 광고 닫기 버튼에 클릭 이벤트 설정
        document.querySelector('.ad-button').addEventListener('click', () => {
            closeAd(); // 광고를 닫고
            window.location.href = clickedHref; // 저장된 href로 이동
        });
        // 네브 바 클릭 했을때 배경 색 주기
        document.querySelectorAll('#sideNav .navbar-collapse .navbar-nav .nav-item').forEach(item => {
            item.addEventListener('click', function() {
                // 모든 nav-item에서 active 클래스 제거
                document.querySelectorAll('#sideNav .navbar-collapse .navbar-nav .nav-item').forEach(navItem => {
                    navItem.classList.remove('active');
                });

                // 클릭된 항목에 active 클래스 추가
                this.classList.add('active');
            });
        });
        // 로고 클릭 시 네브바의 모든 항목에서 active 클래스 제거
        document.querySelector('.navbar-brand').addEventListener('click', function() {
            document.querySelectorAll('#sideNav .navbar-collapse .navbar-nav .nav-item').forEach(navItem => {
                navItem.classList.remove('active');
            });
        });
    });

    // 광고를 열 때 오버레이와 광고 영역을 표시하는 함수
    function openAd() {
        console.log("Open Ad called"); // 함수 호출 시 콘솔에 메시지 출력 (디버깅용)
        document.getElementById('ads-overlay').style.display = 'block'; // 오버레이 표시
        document.getElementById('dummy-ads-container').style.display = 'block'; // 광고 컨테이너 표시
    }

    // 광고를 닫을 때 오버레이와 광고 영역을 숨기는 함수
    function closeAd() {
        document.getElementById('ads-overlay').style.display = 'none'; // 오버레이 숨김
        document.getElementById('dummy-ads-container').style.display = 'none'; // 광고 컨테이너 숨김
    }

</script>

<style>
    #page-top {
        position: relative; /* position을 relative로 설정하여 자식 요소의 절대 위치를 기준으로 합니다. */
        overflow: hidden;   /* 자식 요소가 영역을 넘어갈 경우 숨기기 위해 overflow를 hidden으로 설정합니다. */
    }

    /* 광고 영역 스타일 */
    #dummy-ads-container {
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }

    /* 오버레이 스타일 */
    #ads-overlay {
        backdrop-filter: blur(5px); /* 배경을 흐리게 만들기 위한 효과 */
    }

    /* 버튼들을 감싸는 컨테이너를 Flexbox로 정렬 */
    .button-container {
        display: flex; /* Flexbox 적용 */
        justify-content: center; /* 버튼들을 수평 중앙 정렬 */
        gap: 10px; /* 버튼 사이 간격 */
        margin-top: 10px; /* 위쪽 여백 */
    }

    /* 개별 버튼 스타일 */
    .ad-button {
        background-color: #81C405; /* 버튼 배경색 */
        color: white; /* 텍스트 색상 */
        border: none; /* 테두리 제거 */
        padding: 10px 20px; /* 내부 여백 */
        cursor: pointer; /* 커서 변경 */
        border-radius: 5px; /* 모서리 둥글게 */
        font-size: 14px; /* 폰트 크기 */
    }

    .ad-button:hover {
        background-color: #FFB524; /* 호버 시 색상 변경 */
    }

    /* 스크롤을 막는 CSS */
    body {
        overflow: hidden; /* 스크롤 비활성화 */
    }
</style>
</html>