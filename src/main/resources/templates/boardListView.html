<div th:fragment="boardListView" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns:th="http://www.thymeleaf.org">
	<div class="boardContent">

		<h3>자유게시판</h3>

		<div class="boardNavbar">
			<ul>
				<li><a href="#" class="category-link" data-category="">전체</a></li>
				<li><a href="#" class="category-link" data-category="알림">알림</a></li>
				<li><a href="#" class="category-link" data-category="자취꿀팁">자취꿀팁</a></li>
				<li><a href="#" class="category-link" data-category="사담">사담</a></li>
				<li><a href="#" class="category-link" data-category="기타">기타</a></li>
			</ul>
		</div>

		<div sec:authorize="isAuthenticated()" id="userInfo">
			<img style="width: 22px; height: 22px" src="/img/smiley_icon.png">&nbsp
			<span id="loginUserName" style="font-weight: bold;">사용자</span>님&nbsp&nbsp<button id="boardWriteBt">글쓰기</button>
		</div>

		<div id="boardListContent"></div>

		<div id="paginationControls"></div>

		<!-- 검색폼 -->
		<form id="pagingForm" method="get" th:action="@{/board/list}">
		<div class="searchBox">
			<input type="hidden" name="page" id="page">
			<select id="searchType" name="searchType">
				<option value="title" th:selected="${searchType == 'title'}">제목</option>
				<option value="contents" th:selected="${searchType == 'contents'}">내용</option>
				<option value="name" th:selected="${searchType == 'name'}">작성자</option>
			</select>
			<input type="text" id="searchWord"  name="searchWord" th:value="${searchWord}" placeholder="검색어를 입력하세요">
			<input type="submit" value="검색">
		</div>
		</form>

	</div>

	<style>

		h3{
			text-align: center;
		}

		.boardNavbar{
			display: flex;
			justify-content: center;
			margin: 0 auto;
			margin-top: 40px;
			margin-bottom: 20px;
			width: 80%;

		}

		.boardNavbar ul {
			list-style: none;
			padding: 0;
			margin: 0;
			display: flex;
			justify-content: center;
			gap: 50px;
		}

		.boardNavbar ul li {
			font-family: 'Arial', sans-serif; /* 폰트를 변경 */
			font-size: 1.1rem; /* 글자 크기 */

		}

		.boardNavbar ul li a {
			text-decoration: none; /* 밑줄 제거 */
			color: #333; /* 기본 글자색 */
			font-weight: bold; /* 글자 두껍게 */
			padding: 5px 10px; /* 링크 클릭 영역을 넓히기 위한 패딩 */
			border-radius: 5px; /* 테두리 둥글게 */
			transition: background-color 0.3s, color 0.3s; /* 부드러운 색상 전환 */
		}

		.boardNavbar ul li a:hover {
			color: #81c405; /* 호버 시 글자색 변경 */
			cursor: pointer;
		}

		/* 선택된 카테고리 링크에 대한 스타일 */
		.boardNavbar ul li a.active {
			background-color: #007BFF; /* 선택된 카테고리 배경색 */
			color: white; /* 선택된 카테고리 글자색 */
		}

		#boardWriteBt{
			padding: 8px 10px; /* 패딩을 조절해서 버튼 크기를 줄임 */
			font-size: 15px; /* 글자 크기 조절 */
			border-radius: 4px; /* 테두리를 살짝 둥글게 */
			background-color: #81c405; /* 버튼 배경색 */
			color: white; /* 버튼 글자색 */
			border: none; /* 테두리 제거 */
			cursor: pointer; /* 커서 모양 */
			transition: background-color 0.3s ease; /* 부드러운 색상 전환 */
		}

		#userInfo{
			padding-right: 5%;
			margin-bottom: 20px;
			display: flex;
			align-items: center;
			justify-content: flex-end;
		}

		.boardTable{
			width: 95%;
			margin: 0 auto;
			border-collapse: collapse;
			background-color: #fff;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
			overflow: visible !important;
		}

		.boardTable th, .boardTable td {
			padding: 15px;
			text-align: center;
			border-bottom: 1px solid #ddd;
		}

		.boardTable th {
			background-color: #81c405;
			color: white;
			font-weight: bold;
		}

		#boardTableTbody {
			overflow: visible !important;
			height: auto !important;
		}

		.boardTable tr:nth-child(even) {
			background-color: #f9f9f9;
		}

		.boardTable a {
			color: #81c405;
			text-decoration: none;
		}

		.boardTable a:hover {
			text-decoration: underline;
		}

		#boardListContent{
			height: auto !important;
			overflow: visible !important;
		}

		.boardContent {
			overflow: visible !important;
		}

		#pagingForm{
			margin: 30px 0px 30px 25px;
		}

		form {
			display: flex;
			justify-content: center;
			margin-top: 20px;
		}

		#pagingForm input[type="text"] {
			padding: 7px;
			font-size: 1rem;
			border: 1px solid #ddd;
			border-radius: 4px;
		}

		#pagingForm select, form input[type="submit"] {
			padding: 8px 12px;
			margin-left: 10px;
			font-size: 1rem;
			border: 1px solid #81c405;
			background-color: #81c405;
			color: white;
			border-radius: 4px;
			cursor: pointer;
		}

		#pagingForm input[type="submit"]:hover {
			background-color: #7bb12a;
		}
		.boardNumCol{
			width: 10%;
		}
		.boardCatCol{
			width: 15%;
		}
		.writerNameCol{
			width: 15%;
		}
		.writerDateCol{
			width: 15%;
		}
		#paginationControls{
			display: flex;
			justify-content: center;
			margin-top: 30px;
		}
		.paginationButton{
			background-color: white;
			color: #81c405;
		}

		.searchBox{
			display: flex;
			justify-content: center;
		}

	</style>
	<script src="/js/jquery-3.7.1.min.js"></script>
	<script>

		$(document).ready(function() {

			// 처음에 1페이지 데이터를 불러옴
			loadBoardData(1);

			// 글쓰기 버튼 클릭 시 글쓰기 페이지로 이동
			$('#boardWriteBt').click(function (){
				window.location.href = 'board/write'
			})

			// 카테고리 클릭 이벤트
			$('.category-link').click(function(event) {
				event.preventDefault();
				var category = $(this).data('category');
				loadBoardData(1, '', '', category); // 페이지는 1로 고정, 검색어와 타입은 빈 값
			});

			// 게시판 글 검색 기능 : 검색타입과 단어에 해당하는 글 출력
			$('#pagingForm').submit(function(event) {
				event.preventDefault();
				var searchType = $('#searchType').val();
				var searchWord = $('#searchWord').val();
				loadBoardData(1, searchType, searchWord);
			});

			// 페이지 버튼 클릭 시 해당 페이지로 이동
			$(document).on('click', '.paginationButton', function() {
				var page = $(this).data('page');
				loadBoardData(page);
			});

			// page, searchType, searchWord, category를 파라미터로 받아 해당 게시글 목록을 출력하는 함수
			function loadBoardData(page, searchType = '', searchWord = '', category = '') {
				$.ajax({
					url: '/board/list',
					method: 'GET',
					data: {
						page: page,
						searchWord: searchWord,
						searchType: searchType,
						category: category // 선택한 카테고리를 데이터에 추가
					},
					success: function(response) {
						// 받은 데이터로 게시글 목록 업데이트
						var boardPage = response.boardPage;
						var user = response.user
						var boardList = '';

						$.each(boardPage.content, function(index, board) {
							var formattedDate = formatDate(board.createDate);
							boardList += `<tr>
									<td class="boardNumCol">${board.boardNum}</td>
									<td class="boardCatCol">${board.category}</td>
									<td><a href="/board/read?boardNum=${board.boardNum}">${board.title}</a></td>
									<td class="writerNameCol">${board.name}</td>
									<td class="writerDateCol">${formattedDate}</td>
								</tr>`;
						});

						$('#loginUserName').html(user.name);
						$('#boardListContent').html(`
							<table class="boardTable">
								<tbody id="boardTableTbody">
									<tr>
										<th>번호</th>
										<th>카테고리</th>
										<th>제목</th>
										<th>작성자</th>
										<th>작성일</th>
									</tr>
									${boardList}
								</tbody>
							</table>
                		`);

						// 페이지네이션 업데이트
						var paginationHtml = '';
						if (boardPage.hasPrevious) {
							paginationHtml += `<button class="paginationButton" data-page="${boardPage.number - 1}">이전</button>`;
						}
						for (var i = 1; i <= boardPage.totalPages; i++) {
							paginationHtml += `<button class="paginationButton" data-page="${i}">${i}</button>`;
						}
						if (boardPage.hasNext) {
							paginationHtml += `<button class="paginationButton" data-page="${boardPage.number + 1}">다음</button>`;
						}
						$('#paginationControls').html(paginationHtml);
					},
					error: function(error) {
						console.log("Error loading board data:", error);
					}
				});
			}

			// 날짜를 형식에 맞춰 반환하는 함수
			function formatDate(createDate) {
				var date = new Date(createDate);
				var year = date.getFullYear().toString().slice(-2); // '24'
				var month = (date.getMonth() + 1).toString().padStart(2, '0'); // '09'
				var day = date.getDate().toString().padStart(2, '0'); // '11'
				var hour = date.getHours().toString().padStart(2, '0'); // '10'
				var minute = date.getMinutes().toString().padStart(2, '0'); // '09'
				return `${year}.${month}.${day} ${hour}:${minute}`;
			}

		});

	</script>

</div>
