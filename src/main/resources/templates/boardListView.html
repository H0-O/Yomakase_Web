<div th:fragment="boardListView" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns:th="http://www.thymeleaf.org">
	<div class="boardContent">

		<h3>자유게시판</h3>

		<div class="boardNavbar">
			<ul>
				<li><a href="/board/category?category=알림">알림</a></li>
				<li><a href="/board/category?category=자취꿀팁">자취꿀팁</a></li>
				<li><a href="/board/category?category=사담">사담</a></li>
				<li><a href="/board/category?category=기타">기타</a></li>
			</ul>
		</div>

		<div sec:authorize="isAuthenticated()" id="userInfo">
			<img style="width: 22px; height: 22px" src="/img/smiley_icon.png">&nbsp
			<span id="loginUserName" style="font-weight: bold;">사용자</span>님&nbsp&nbsp<button id="boardWriteBt">글쓰기</button>
		</div>

		<div id="boardListContent"></div>

		<div id="paginationControls"></div>

		<!-- 검색폼 -->
		<form id="pagingForm" method="get" th:action="@{/board/list}">
		<div class="searchBox">
			<input type="hidden" name="page" id="page">
			<select id="searchType" name="searchType">
				<option value="title" th:selected="${searchType == 'title'}">제목</option>
				<option value="contents" th:selected="${searchType == 'contents'}">내용</option>
				<option value="name" th:selected="${searchType == 'name'}">작성자</option>
			</select>
			<input type="text" id="searchWord"  name="searchWord" th:value="${searchWord}" placeholder="검색어를 입력하세요">
			<input type="submit" value="검색">
		</div>
		</form>

	</div>

	<style>
		.boardNavbar {
			display: flex;
			justify-content: center;
			background-color: #f4f4f4;
			padding: 15px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			margin: 0 auto;
			margin-bottom: 20px;
			width: 80%;
		}

		h3{
			text-align: center;
		}

		.boardNavbar ul {
			list-style: none;
			display: flex;
			gap: 100px;
			padding: 0;
			margin: 0;
		}

		.boardNavbar ul li {
			font-size: 1.1rem;
			font-weight: bold;
			color: #555;
		}

		.boardNavbar ul li:hover {
			color: #81c405;
			cursor: pointer;
		}

		#boardWriteBt{
			display: inline;
		}

		#userInfo{
			padding-left: 10%;
			margin-bottom: 20px;
			display: flex;
			align-items: center;
		}

		.boardTable{
			width: 95%;
			margin: 0 auto;
			border-collapse: collapse;
			background-color: #fff;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
			overflow: visible !important;
		}

		.boardTable th, .boardTable td {
			padding: 15px;
			text-align: center;
			border-bottom: 1px solid #ddd;
		}

		.boardTable th {
			background-color: #81c405;
			color: white;
			font-weight: bold;
		}

		#boardTableTbody {
			overflow: visible !important;
			height: auto !important;
		}

		.boardTable tr:nth-child(even) {
			background-color: #f9f9f9;
		}

		.boardTable a {
			color: #81c405;
			text-decoration: none;
		}

		.boardTable a:hover {
			text-decoration: underline;
		}

		#boardListContent{
			height: auto !important;
			overflow: visible !important;
		}

		.boardContent {
			overflow: visible !important;
		}

		#pagingForm{
			margin: 30px 0px 30px 25px;
		}

		form {
			display: flex;
			justify-content: center;
			margin-top: 20px;
		}

		#pagingForm input[type="text"] {
			padding: 7px;
			font-size: 1rem;
			border: 1px solid #ddd;
			border-radius: 4px;
		}

		#pagingForm select, form input[type="submit"] {
			padding: 8px 12px;
			margin-left: 10px;
			font-size: 1rem;
			border: 1px solid #81c405;
			background-color: #81c405;
			color: white;
			border-radius: 4px;
			cursor: pointer;
		}

		#pagingForm input[type="submit"]:hover {
			background-color: #7bb12a;
		}
		.boardNumCol{
			width: 10%;
		}
		.boardCatCol{
			width: 15%;
		}
		.writerNameCol{
			width: 15%;
		}
		.writerDateCol{
			width: 15%;
		}
		#paginationControls{
			display: flex;
			justify-content: center;
			margin-top: 30px;
		}
		.paginationButton{
			background-color: white;
			color: #81c405;
		}

		.searchBox{
			display: flex;
			justify-content: center;
		}

	</style>
	<script src="/js/jquery-3.7.1.min.js"></script>
	<script>

		$(document).ready(function() {

			$('#boardWriteBt').click(function (){
				window.location.href = 'board/write'
			})

			loadBoardData(1); // 처음에 1페이지 데이터를 불러옴

			$('#pagingForm').submit(function(event) {
				event.preventDefault();
				var searchType = $('#searchType').val();
				var searchWord = $('#searchWord').val();
				loadBoardData(1, searchType, searchWord);
			});

			$(document).on('click', '.paginationButton', function() {
				var page = $(this).data('page');
				loadBoardData(page);
			});

			function loadBoardData(page, searchType = '', searchWord = '') {
				$.ajax({
					url: '/board/list',
					method: 'GET',
					data: {
						page: page,
						searchWord: searchWord, // 검색어 반영
						searchType: searchType  // 검색 타입 반영
					},
					success: function(response) {

						var user = response.user;
						var boardPage = response.boardPage;
						var boardList = '';

						$.each(boardPage.content, function(index, board) {
							var formattedDate = formatDate(board.createDate);
							boardList += `<tr>
                    <td class="boardNumCol">${board.boardNum}</td>
                    <td class="boardCatCol">${board.category}</td>
                    <td><a href="/board/read?boardNum=${board.boardNum}">${board.title}</a></td>
                    <td class="writerNameCol">${board.name}</td>
                    <td class="writerDateCol">${formattedDate}</td>
                </tr>`;
						});
						$('#loginUserName').html(user.name);
						$('#boardListContent').html(`
                <table class="boardTable">
                    <tbody id="boardTableTbody">
                        <tr>
                            <th>번호</th>
                            <th>카테고리</th>
                            <th>제목</th>
                            <th>작성자</th>
                            <th>작성일</th>
                        </tr>
                        ${boardList}
                    </tbody>
                </table>
            `);

						var paginationHtml = '';
						if (boardPage.hasPrevious) {
							paginationHtml += `<button class="paginationButton" data-page="${boardPage.number - 1}">이전</button>`;
						}
						for (var i = 1; i <= boardPage.totalPages; i++) {
							paginationHtml += `<button class="paginationButton" data-page="${i}">${i}</button>`;
						}
						if (boardPage.hasNext) {
							paginationHtml += `<button class="paginationButton" data-page="${boardPage.number + 1}">다음</button>`;
						}
						$('#paginationControls').html(paginationHtml);
					},
					error: function(error) {
						console.log("Error loading board data:", error);
					}
				});
			}

			function formatDate(createDate) {
				var date = new Date(createDate);
				var year = date.getFullYear().toString().slice(-2); // '24'
				var month = (date.getMonth() + 1).toString().padStart(2, '0'); // '09'
				var day = date.getDate().toString().padStart(2, '0'); // '11'
				var hour = date.getHours().toString().padStart(2, '0'); // '10'
				var minute = date.getMinutes().toString().padStart(2, '0'); // '09'
				return `${year}.${month}.${day} ${hour}:${minute}`;
			}

		});

	</script>

</div>
