<div th:fragment="refrigerator">
    <style>
        .refrigerator-photo {
            position: relative; /* 상대 위치로 자식 요소를 절대 위치로 배치할 수 있게 함 */
        }

        .refrigerator-container {
            position: relative; /* 냉장고 이미지와 식재료를 함께 감싸는 컨테이너 */
            background-image: url('/img/refri.png');
            background-size: cover; /* 배경 이미지 크기 조절 */
            background-position: center; /* 이미지 위치 조정 */
            width: 350px; /* 냉장고 이미지 너비 */
            height: 650px; /* 냉장고 이미지 높이 */
            overflow: hidden; /* 자식 요소가 컨테이너를 넘어가지 않도록 설정 */
        }

        #ingredients-container {
            position: absolute; /* 식재료 컨테이너를 절대 위치로 설정 */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: translateX(9px); /* 원하는 이동 값 (픽셀 단위) */
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-content: space-between;
        }

        .ingredient {
            text-align: center; /* 텍스트를 중앙에 위치시킴 */
            cursor: pointer; /* 클릭 가능한 영역을 표시 */
            margin: 10px; /* 아이템 간격 */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 106px; /* 각 아이템의 너비 설정 */
            height: 106px; /* 각 아이템의 높이 설정 */
            box-sizing: border-box;
            position: relative; /* 이미지 위에 텍스트를 배치하기 위한 상대적 위치 */
            transform: translateY(95px); /* 그리드를 아래로 이동 */
        }

        .ingredient img {
            width: 100px; /* 식재료 이미지의 너비 조정 */
            height: auto; /* 이미지 비율 유지 */
            display: block; /* 이미지 블록으로 설정 */
        }

        .ingredient-text {
            text-align: center;
            bottom: 0; /* 텍스트를 이미지 아래쪽에 위치시킴 */
            left: 100px; /* 텍스트를 이미지 중앙에 위치시킴 */
            background-color: rgba(0, 0, 0, 0.7); /* 반투명 배경색 */
            color: white; /* 글자 색상 */
            letter-spacing: 1px; /* 글자 간격 */
            padding: 5px;
            border-radius: 3px;
            opacity: 0; /* 기본적으로 텍스트는 보이지 않음 */
            transition: opacity 0.3s ease; /* 부드러운 전환 효과 */
            white-space: nowrap; /* 텍스트 줄바꿈 방지 */
            display: inline-block; /* 텍스트 길이에 맞춰 너비 조정 */
            box-sizing: content-box; /* 패딩과 테두리가 너비에 포함되지 않도록 설정 */
            max-width: 100%; /* 텍스트가 이미지 너비를 넘지 않도록 설정 */
            word-wrap: break-word; /* 긴 단어가 줄 바꿈 되도록 설정 */
        }

        .ingredient:hover .ingredient-text {
            opacity: 1; /* 마우스 오버 시 텍스트가 보이게 함 */
        }

        .refrigerator-wrapper {
            display: flex;
            align-items: center; /* 상단 정렬 */
            justify-content: center; /* 중앙 정렬 */
            gap: 20px; /* 사진과 테이블 사이에 여백 */
            padding: 20px;
        }

        .refrigerator-photo, .table-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .table-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden; /* 스크롤바가 생기지 않도록 컨테이너에서 숨김 */
            letter-spacing: 1px;
        }

        .table-wrapper {
            max-width: 600px; /* 테이블의 최대 너비 설정 */
            height: auto; /* 테이블의 고정 높이 설정 */
            border: 4px solid #81c405; /* 테이블 컨테이너의 테두리 */
            border-radius: 10px; /* 테이블의 둥근 테두리 */
            display: flex;
            justify-content: center; /* 테이블 중앙 정렬 */
        }

        table, td, th {
            border-collapse: collapse;
            border-spacing: 0; /* 셀 간의 간격을 0으로 설정 */
            table-layout: auto;
            height: auto;
            width: 300px;
            border: 1px #81c405; /* 셀의 테두리 */
            padding: 8px;
            text-align: center;
            letter-spacing: 1px;
            word-wrap: break-word; /* 긴 단어가 넘치면 줄 바꿈 */
        }

        thead, tbody {
            display: block; /* 헤더와 본문을 블록으로 설정하여 개별적으로 스크롤 */
        }

        tbody {
            max-height: 350px; /* 본문 영역의 최대 높이 설정 */
            overflow-y: auto; /* 본문에만 스크롤바 추가 */
        }

        th {
            background-color: #81c405;
            color: white;
        }

        .d-day {
            font-weight: bold;
            color: #000;
        }

        .d-day-warning {
            font-weight: bold;
            color: red; /* 디데이가 하루 남은 경우 빨간색으로 표시 */
        }

        .d-day-last {
            font-weight: bold;
            color: blue; /* 디데이면 파란색으로 표시 */
        }

        .d-day-over {
            font-weight: bold;
            color: #ffb524; /* 넘기면 파란색으로 표시 */
        }

        .refriBtn {
            margin: auto;
            padding: 5px 10px;
            background-color: #81c405;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            box-shadow: -3px -3px 7px #fff, 2px 2px 4px #babebc;
            outline: none;
            font-weight: bold;
            letter-spacing: 1px;
            transition: transform 80ms ease-in;

            display: inline-block;
        }

        .refriBtn:active {
            box-shadow: inset 1px 1px 2px #babebc, inset -1px -1px 2px #fff;
        }

        .refriBtn:hover {
            background-color: #ffb524;
        }

        tbody::-webkit-scrollbar {
            width: 8px;
        }

        tbody::-webkit-scrollbar-thumb {
            background: #ffb524; /* 스크롤바 색상 */
            border-radius: 10px;
        }

        tbody::-webkit-scrollbar-track {
            background: #f1f1f1; /* 스크롤바 트랙 색상 */
        }

        .modal-overlay {
            z-index: 1000; /* 모달이 다른 콘텐츠 위에 위치하도록 설정 */
            display: none; /* 페이지 로드 시 모달이 보이지 않도록 설정 */
            position: fixed; /* absolute */
            width: 100%;
            height: 100%; /* 1075px */
            left: 0;
            top: 0; /* 737px */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(1.5px);
            -webkit-backdrop-filter: blur(1.5px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .modal-window {
            z-index: 1001; /* 오버레이 위에 위치하도록 설정 */
            background: ivory;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(13.5px);
            -webkit-backdrop-filter: blur(13.5px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            position: relative;
            margin: auto;
            padding: 20px; /* 10px */
            max-width: 800px; /* 모달 너비 설정 */
            max-height: 600px; /* 모달 높이 설정 */
        }

        #RecipeModal .modal-window {
            width: 800px;
            height: 600px;
            overflow: auto; /* 스크롤 가능하도록 설정 */
        }

        #delModal .modal-window {
            width: 260px;
            height: 140px;
            text-align: center;
            /*display: flex; !* Flexbox 사용 *!*/
            justify-content: center; /* 가로 중앙 정렬 */
            flex-direction: row; /* 가로 방향으로 정렬 */
            align-items: center; /* 세로 중앙 정렬 */
        }

        #dateModal .modal-window {
            width: 300px;
            height: 150px;
        }

        /* ID가 delModal인 요소의 자식 요소 중에서 클래스가 close-area인 요소를 선택함 */
        /* #delModal .close-area = ID가 delModal이면서 동시에 클래스가 close-area인 요소를 선택함 */
        #RecipeModal .close-area, #delModal .close-area, #dateModal .close-area {
            display: inline;
            float: right;
            padding-right: 10px;
            cursor: pointer;
            color: black;
        }

        #delModal .modal-text {
            letter-spacing: 1px;
            font-weight: bold;
            font-size: 20px;
            text-align: center;
            padding-top: 8px;
            padding-left: 20px;
        }

        #delModal .button-container {
            margin: auto;
        }

        #delModal .refriBtn {
            margin: 10px;
            padding: 10px;
            font-size: 20px;
        }

        #dateModal .date-text {
            letter-spacing: 1px;
            font-weight: bold;
            font-size: 20px;
            text-align: center;
            padding-left: 12px;
        }

        #date-container input[type="date"] {
            margin-left: 40px;
        }

        #date-container {
            display: flex;
            flex-direction: column; /* 수직 정렬 */
        }

        .date-input-container {
            display: flex; /* 수평 정렬 */
            align-items: center; /* 수직 중앙 정렬 */
        }

        #submitDate {
            text-align: center;
            display: flex; /* 수평 정렬 */
            align-items: center; /* 수직 중앙 정렬 */
            justify-content: center; /* 가로 중앙 정렬 */
            flex-direction: row; /* 가로 방향으로 정렬 */
            margin: auto;
        }

        #RecipeModal .title {
            padding-left: 10px;
            display: inline;
            color: black;
        }

        #RecipeModal .title h2 {
            display: inline;
        }

        #RecipeModal .content {
            margin-top: 20px;
            padding: 0px 10px;
            color: black;
        }
    </style>
    <!-- 나의 냉장고 -->
    <section class="resume-section" id="myRefrigerator">
        <div class="resume-section-content" id="myRefrigeratorContent">
            <div class="refrigerator-wrapper">
                <div class="refrigerator-photo">
                    <!-- 레시피 모달창 버튼 -->
                    <button id="RecipeModalBtn" class="refriBtn">요리법 추천</button>
                    <br>
                    <div class="refrigerator-container" id="refrigerator-container">
                        <!-- 냉장고 배경 이미지 추가 -->
                        <div id="ingredients-container">
                            <!-- 식재료 이미지 담을 컨테이너 -->
                        </div>
                    </div>
                </div>
                <br>
                <!-- 데이터 테이블 영역 -->
                <div class="table-container" id="tableContainer" style="display: none;">
                    <div class="table-wrapper">
                        <table id="materialsTable">
                            <thead>
                            <tr>
                                <th>소비기한</th>
                            </tr>
                            </thead>
                            <tbody id="list">
                            <!-- 식재료 테이블 데이터 -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- 데이터가 없을 때 보여줄 페이지 -->
                <div id="noDataMessage" style="display: none;">
                    <p>현재 저장된 재료가 없습니다.</p>
                </div>
                <!-- 식재료 삭제 모달 페이지 -->
                <div id="delModal" class="modal-overlay">
                    <div class="modal-window">
                        <div class="close-area">X</div>
                        <div class="modal-text">
                            <!-- 모달에 식재료 이름 표시 -->
                        </div>
                        <div class="button-container">
                            <button class="refriBtn" id="consume-btn">소비</button>
                            <button class="refriBtn" id="discard-btn">버림</button>
                        </div>
                    </div>
                </div>
                <!-- 날짜 수정 모달 페이지 -->
                <div id="dateModal" class="modal-overlay">
                    <div class="modal-window">
                        <div class="close-area">X</div>
                        <p class="date-text">소비기한 수정</p>
                        <div id="date-container">
                            <input type="hidden" id="ingredientName" value="">
                            <input type="hidden" id="memberNum" value="">
                            <div class="date-input-container">
                                <input type="date" id="date">
                                <button id="submitDate" class="refriBtn">확인</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 레시피 모달 페이지 -->
                <div id="RecipeModal" class="modal-overlay">
                    <div class="modal-window">
                        <div class="title">
                            <h2>추천메뉴</h2>
                            <button class="refriBtn">레시피 저장</button>
                        </div>
                        <div class="close-area">X</div>
                        <div class="content">
                            <span>식재료명</span>
                            <button class="refriBtn">구매</button>
                            <pre>
                                        레시피 나열
                                        .
                                        .
                                        .
                                    </pre>
                            <p>동영상 링크 첨부</p>
                            <iframe width="560" height="315"
                                    src="https://www.youtube.com/embed/sx0Z-NU74a4?si=S6eXIKsvxv5wzlDz"
                                    title="YouTube video player" frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script th:src="@{/jq/jquery-3.7.1.min.js}"></script>
    <script>
        // 날짜 수정 ajax
        $(document).ready(function () {
            // 모달 열기
            function dateModalOn(ingredientName, memberNum) {
                // 모달창을 열기 전에 값 설정
                document.getElementById('ingredientName').value = ingredientName;
                document.getElementById('memberNum').value = memberNum;
                $('#dateModal').fadeIn();  // 모달창 열기 (fade 효과)
            }

            // 모달이 열려 있는지 확인
            function isDateModalOn() {
                console.log($("#dateModal").css("display")); // 모달 상태 로그로 확인
                return $("#dateModal").css("display") === "flex";
            }

            // 모달 닫기
            function dateModalOff() {
                $('#dateModal').fadeOut();  // 모달창 닫기 (fade 효과)
            }

            // 테이블에서 수정 버튼을 클릭하면 모달을 띄우고 값 세팅
            $('#list').on('click', '.refriBtn', function () {
                const ingredientName = $(this).data('ingredient-name');
                const memberNum = $(this).data('member-num');

                // 모달 열기 전에 데이터가 제대로 들어갔는지 확인
                console.log('ingredientName:', ingredientName);
                console.log('memberNum:', memberNum);

                // 모달 열기
                dateModalOn(ingredientName, memberNum);
            });

            // X 버튼 클릭 시 모달 닫기
            $('.close-area').click(function () {
                dateModalOff();
            });

            // 모달창 바깥 영역을 클릭하면 모달창이 꺼지게 하기
            $('#dateModal').click(function (e) {
                // 클릭한 대상이 모달 자체인지 확인
                if ($(e.target).is('#dateModal')) {
                    dateModalOff(); // 모달 닫기 함수 호출
                }
            });

            // // ESC 키를 누르면 모달 닫기 - 작동안됨 기능고치기
            // $(document).on('keyup', function (e) {
            //     if (e.key === "Escape") { // ESC 키를 확인
            //         if (isDateModalOn()) { // 모달이 열려 있는지 확인
            //             dateModalOff(); // 모달 닫기
            //         }
            //     }
            // });

            // 확인 버튼 클릭 시 날짜 업데이트
            $('#submitDate').click(function () {
                const dateInput = $('#date').val();  // 날짜 입력 값
                const ingredientName = $('#ingredientName').val();
                const memberNum = $('#memberNum').val();

                if (!dateInput) {
                    alert('날짜를 선택해주세요.');
                    return;
                }

                // 서버로 데이터 전송
                fetch('/rest/stockDate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ingredientName: ingredientName,
                        memberNum: memberNum,
                        useByDate: dateInput
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('날짜가 성공적으로 업데이트되었습니다.');

                            dateModalOff(); // 모달 닫기

                            location.reload(); // 페이지 새로고침
                        } else {
                            alert('업데이트에 실패했습니다.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('서버와의 통신 중 오류가 발생했습니다.');
                    });
            });
        }); // 날짜 수정문 끝

        function calculateDday(dateString) {
            // 현재 날짜
            const today = new Date();
            today.setHours(0, 0, 0, 0); // 오늘 날짜의 시간을 0으로 설정
            // useByDate를 Date 객체로 변환
            const useByDate = new Date(dateString);
            useByDate.setHours(0, 0, 0, 0); // 소비기한 날짜의 시간도 0으로 설정

            // 남은 일수 계산
            const timeDiff = useByDate - today;
            const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

            // 디데이 형식으로 반환
            if (daysLeft > 0) {
                return `D-${daysLeft}`;
            } else if (daysLeft === 0) {
                return "D-Day";
            } else {
                return `D+${Math.abs(daysLeft)}`;
            }
        }

        function getDdayClass(daysLeft) {
            if (daysLeft === 0) {
                return "d-day-last";
            } else if (daysLeft > 0 && daysLeft <= 1) {
                return "d-day-warning";
            } else if (daysLeft < 0){
                return "d-day-over";
            } else {
                return "d-day";
            }
        }

        $(document).ready(function() {
            $.ajax({
                url : "/rest/stockData",
                type : "POST",
                dataType : "json",
                success : function(list) {
                    console.log(list); // 데이터 형식 확인

                    // 테이블이 담길 변수
                    let txt = ``;

                    // 데이터가 있는지 확인
                    if (list.length > 0) {
                        // 소비기한을 기준으로 오름차순 정렬
                        list.sort(function (a, b) {
                            return new Date(a.useByDate) - new Date(b.useByDate);
                        });

                        // 테이블 시작
                        txt += `<table>`;

                        $(list).each(function (index, object) {
                            const today = new Date();
                            const useByDate = new Date(object.useByDate);
                            const timeDiff = useByDate - today;
                            const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                            const dDayText = calculateDday(object.useByDate);
                            const dDayClass = getDdayClass(daysLeft);

                            // 테이블 행 추가
                            txt += `
                            <tr>
                                <td>${object.ingredientName}</td>
                                <td class="${dDayClass}">${dDayText}</td>
                                <td><button class="refriBtn" data-ingredient-name="${object.ingredientName}" data-member-num="${object.memberNum}">수정</button></td>
                            </tr>`;
                        });
                        // 테이블 끝
                        txt += `</table>`;
                    } else {
                        // 데이터가 없을 때 표시할 메시지
                        txt = `<p>현재 저장된 재료가 없습니다.</p>`;
                    }
                    // 데이터를 테이블 영역에 삽입
                    $("#list").html(txt);

                    // 데이터가 있을 때는 테이블을 표시하고 없을 때는 메시지 표시
                    if (list.length > 0) {
                        $("#tableContainer").show();  // 테이블 표시
                        $("#noDataMessage").hide();   // 데이터 없을 때 메시지 숨김
                    } else {
                        $("#tableContainer").hide();  // 테이블 숨김
                        $("#noDataMessage").show();   // 데이터 없을 때 메시지 표시
                    }
                },
                error: function(xhr, status, error) {
                    console.error("AJAX 요청 실패:", status, error); // 에러 메시지 확인
                    console.error("응답 내용:", xhr.responseText); // 추가된 부분
                    alert("출력 실패");
                }
            });
        }); // stock 테이블 출력문 끝

        document.addEventListener('DOMContentLoaded', function() {
            fetch('/rest/stockImg')  // 컨트롤러 경로에 맞추어 요청
                .then(response => response.json())
                .then(stockItems => {
                    const container = document.getElementById('ingredients-container');

                    // 테이블의 내용을 초기화
                    const listElement = document.getElementById('list');
                    listElement.innerHTML = ''; // 이전 내용 제거

                    if (stockItems.length === 0) {
                        // 데이터가 없을 경우 메시지 표시
                        const noDataMessage = document.createElement('tr');
                        noDataMessage.innerHTML = '<td colspan="3">등록된 식재료가 없습니다.</td>'; // 모든 열을 차지하도록 설정
                        listElement.appendChild(noDataMessage);
                    } else {
                        // 컨테이너의 크기
                        const containerWidth = container.offsetWidth;
                        const containerHeight = container.offsetHeight;

                        // 그리드의 행과 열 수
                        const rows = 3;
                        const cols = 3;

                        // 각 아이템의 크기 (가로 및 세로)
                        const itemWidth = containerWidth / cols;
                        const itemHeight = containerHeight / rows;

                        // 간격 조정 값 (픽셀 단위)
                        const colGap = -15;  // 간격을 줄이기 위한 값 (조정 가능)
                        const rowGap = -85;

                        stockItems.forEach((item, index) => {
                            const ingredientDiv = document.createElement('div');
                            ingredientDiv.className = 'ingredient';

                            // JSON 데이터의 필드에 맞게 수정
                            const img = document.createElement('img');
                            img.src = `/img/${item.image}`; // 서버에서 반환된 이미지 파일명과 경로 사용
                            img.alt = item.name; // 서버에서 반환된 재료 이름
                            img.className = 'del-modal'; // 클릭 이벤트를 위한 클래스

                            img.addEventListener('click', () => {
                                delModalOn(); // 클릭 시 모달 열기
                            });

                            const text = document.createElement('div');
                            text.className = 'ingredient-text';
                            text.textContent = item.name;  // 재료 이름 텍스트로 사용

                            ingredientDiv.appendChild(img);
                            ingredientDiv.appendChild(text);

                            // 위치를 설정 (3x3 그리드에 맞게 배치)
                            const rowIndex = Math.floor(index / cols);
                            const colIndex = index % cols;

                            // 간격을 고려하여 위치 조정
                            ingredientDiv.style.position = 'absolute'; // absolute 위치 설정 필요
                            ingredientDiv.style.top = `${rowIndex * (itemHeight + rowGap)}px`; // y축 위치
                            ingredientDiv.style.left = `${colIndex * (itemWidth + colGap)}px`; // x축 위치

                            // 삭제 버튼 클릭 이벤트 추가
                            ingredientDiv.addEventListener('click', () => showIngredientName(item.name));

                            container.appendChild(ingredientDiv);
                        });
                    }
                })
                .catch(error => console.error('Error:', error));
        }); // stock 이미지 출력문 끝

        // 재료 삭제 모달
        const delModal = document.getElementById('delModal');
        const modalText = delModal.querySelector('.modal-text');

        function showIngredientName(text) {
            modalText.textContent = text;
            delModalOn();
        }

        function delModalOn() {
            delModal.style.display = 'flex';
        }

        function isDelModalOn() {
            return delModal.style.display === "flex";
        }

        function delModalOff() {
            delModal.style.display = 'none';
        }

        // 모달창의 클로즈(x) 버튼을 누르면 모달창이 꺼지게 하기
        const closeDel = delModal.querySelector(".close-area");
        closeDel.addEventListener("click", () => {
            delModalOff();
        });

        // 모달창 바깥 영역을 클릭하면 모달창이 꺼지게 하기
        delModal.addEventListener("click", (e) => {
            if (e.target.classList.contains("modal-overlay")) {
                delModalOff();
            }
        });

        // 모달창이 켜진 상태에서 ESC 버튼을 누르면 모달창이 꺼지게 하기
        window.addEventListener("keyup", (e) => {
            if (isDelModalOn() && e.key === "Escape") {
                delModalOff();
            }
        }); // 삭제 모달창 끝

        // // 날짜 수정 모달
        // document.addEventListener("DOMContentLoaded", () => {
        //     const dateModal = document.getElementById("dateModal");
        //     const dateInput = document.getElementById("date"); // ID를 'date'로 변경
        //     const submitDate = document.getElementById("submitDate");
        //     const closeDate = dateModal.querySelector(".close-area");
        //     const list = document.getElementById("list");
        //
        //     // 모달을 보이게 함
        //     function dateModalOn(ingredientName, memberNum) {
        //         console.log('모달 데이터 설정:', ingredientName, memberNum); // 추가된 로그
        //         document.getElementById('ingredientName').value = ingredientName;
        //         document.getElementById('memberNum').value = memberNum;
        //         dateModal.style.display = "flex";
        //     }
        //
        //     // 모달이 열려 있는지 확인
        //     function isDateModalOn() {
        //         return dateModal.style.display === "flex";
        //     }
        //
        //     // 모달을 숨김
        //     function dateModalOff() {
        //         dateModal.style.display = "none";
        //     }
        //
        //     // 특정 버튼을 누르면 모달창이 켜지게 하기
        //     list.addEventListener("click", (event) => {
        //         if (event.target.tagName === 'BUTTON' && event.target.classList.contains('refriBtn')) {
        //
        //             const ingredientName = $(this).data('ingredient-name');
        //             const memberNum = $(this).data('member-num');
        //
        //             console.log('ingredientName:', ingredientName);
        //             console.log('memberNum:', memberNum);
        //
        //             dateModalOn(ingredientName, memberNum);
        //         }
        //     });
        //
        //     // 모달창의 클로즈(x) 버튼을 누르면 모달창이 꺼지게 하기
        //     closeDate.addEventListener("click", () => {
        //         dateModalOff();
        //     });
        //
        //     // 모달창 바깥 영역을 클릭하면 모달창이 꺼지게 하기
        //     dateModal.addEventListener("click", (e) => {
        //         if (e.target === dateModal) {
        //             dateModalOff();
        //         }
        //     });
        //
        //     // 모달창이 켜진 상태에서 ESC 버튼을 누르면 모달창이 꺼지게 하기
        //     window.addEventListener("keyup", (e) => {
        //         if (isDateModalOn() && e.key === "Escape") {
        //             dateModalOff();
        //         }
        //     });
        //
        //     // 날짜 선택 모달의 확인 버튼 클릭 시 날짜 처리
        //     submitDate.addEventListener("click", () => {
        //         const selectedDate = dateInput.value;
        //         if (selectedDate) {
        //             console.log('Selected Date:', selectedDate); // 선택된 날짜를 콘솔에 출력
        //             dateModal.style.display = 'none'; // 모달 닫기
        //         } else {
        //             alert('날짜를 선택해주세요.');
        //         }
        //     });
        // }); // 수정 모달창 끝

        // 레시피 추천 버튼 클릭 시
        document.getElementById('RecipeModalBtn').addEventListener('click', function() {
            // 테이블의 모든 행(tr)을 선택
            const rows = document.querySelectorAll("#materialsTable tbody tr");

            // 재료 이름들을 저장할 배열
            let ingredientNames = [];

            // 각 행을 순회하며 첫 번째 셀(td)의 텍스트(재료 이름)를 배열에 추가
            rows.forEach(function(row) {
                const ingredientName = row.querySelector("td:first-child").textContent.trim();
                ingredientNames.push(ingredientName);
            });

            // 알러지 정보 중 true인 것만 추출
            const allergies = Object.entries(memberAllergies)
                .filter(([key, value]) => value === true)  // 값이 true인 항목만 필터링
                .map(([key]) => key);  // 필터링된 항목의 키(알러지 이름)만 추출

            // 이후 이 데이터를 Python FastAPI 서버로 전송하거나 다른 작업에 사용
            const requestData = {
                allergies: allergies,  // true인 알러지 정보
                ingredients: ingredientNames  // 수집한 재료 이름 목록
            };
            console.log(requestData)

            // 예시로 서버에 데이터를 전송하는 코드 (fetch 사용)
            fetch('http://localhost:8000/recipe-recommend', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData),
            })
                .then(response => response.json())
                .then(data => console.log('Success:', data))
                .catch((error) => console.error('Error:', error));
        });


        // 레시피 추천 모달
        const RecipeModal = document.getElementById("RecipeModal");

        function RecipeModalOn() {
            RecipeModal.style.display = "flex"; // 모달을 보이게 함
        }

        function isRecipeModalOn() {
            return RecipeModal.style.display === "flex"; // 모달이 열려 있는지 확인
        }

        function RecipeModalOff() {
            RecipeModal.style.display = "none"; // 모달을 숨김
        }

        const RecipeModalBtn = document.getElementById("RecipeModalBtn");

        // 특정 버튼을 누르면 모달창이 켜지게 하기
        RecipeModalBtn.addEventListener("click", () => {
            RecipeModalOn();
        });

        // 모달창의 클로즈(x) 버튼을 누르면 모달창이 꺼지게 하기
        const closeBtn = RecipeModal.querySelector(".close-area");
        closeBtn.addEventListener("click", () => {
            RecipeModalOff();
        });

        // 모달창 바깥 영역을 클릭하면 모달창이 꺼지게 하기
        RecipeModal.addEventListener("click", (e) => {
            if (e.target === RecipeModal) {
                RecipeModalOff();
            }
        });

        // 모달창이 켜진 상태에서 ESC 버튼을 누르면 모달창이 꺼지게 하기
        window.addEventListener("keyup", (e) => {
            if (isRecipeModalOn() && e.key === "Escape") {
                RecipeModalOff();
            }
        }); // 레시피 모달창 끝
    </script>

</div>