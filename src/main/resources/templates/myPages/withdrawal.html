<div th:fragment="withdrawalFragment">
    <div id="modal-deleteAccount" class="withdrawal-modal-content">
        <h3>회원 탈퇴</h3>
        <p class="withdrawal-warning">정말로 회원 탈퇴를 하시겠습니까?</p>
        <p class="withdrawal-danger">※ 탈퇴 시 모든 정보가 삭제되며 복구할 수 없습니다.</p>
        <p class="withdrawal-info">회원님의 모든 데이터가 삭제되며, 탈퇴 후에는 재가입이 필요합니다.</p>
        <!-- 동의 체크박스 추가 -->
        <div class="withdrawalBtn">
            <input type="checkbox" id="agreeCheckbox">
            <label for="agreeCheckbox">회원탈퇴에 동의함</label>
        </div>
        <div class="withdrawal-button-container">
            <button class="withdrawal-cancelNoButton" onclick="cancelDelete()">아니오</button>
            <button id="withdrawal-cancelYesButton" class="withdrawal-cancelYesButton" onclick="deleteAccount()" disabled>예</button>
        </div>
    </div>
    <style>
        /* 모달 창 스타일 */
        .withdrawal-modal-content {
            font-family: 'Arial', sans-serif;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            margin: 20px auto;
            padding: 20px;
            width: 90%;
            max-width: 900px;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        /* 경고 스타일 */
        .withdrawal-warning {
            font-size: 18px;
            color: #333;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* 심각한 경고 스타일 */
        .withdrawal-danger {
            color: red;
            font-size: 16px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        /* 추가 안내 정보 스타일 */
        .withdrawal-info {
            color: #555;
            font-size: 14px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        /* 버튼 컨테이너 스타일 */
        .withdrawal-button-container {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-top: 30px;
            margin-bottom: 30px;
        }

        .withdrawal-cancelYesButton:active {
            transform: translateY(2px);
        }

        /* 버튼 컨테이너 스타일 */
        .withdrawal-button-container {
            display: flex;
            justify-content: center;
            gap: 10px; /* 버튼 간의 간격을 조절 */
            margin-top: 20px;
        }

        /* 버튼 스타일 */
        .withdrawal-cancelNoButton,
        .withdrawal-cancelYesButton {
            padding: 10px 20px;
            background-color: #81c405;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .withdrawal-cancelNoButton:hover,
        .withdrawal-cancelYesButton:hover {
            background-color: #555 !important;
            opacity: 0.9;
        }

        /* 모달창 안의 텍스트 */
        .modal-content p {
            margin: 20px 0;
            word-wrap: break-word;
        }

        .withdrawalBtn input {
            transform: scale(1.5); /* 체크박스 크기 조절 */
            margin-right: 5px; /* 텍스트와의 간격 조절 */
        }

        .withdrawalBtn label {
            font-size: 16px; /* 텍스트 크기 조절 */
        }
    </style>
    <script>
        function cancelDelete() {
            // 회원 탈퇴 취소 시 아무런 동작도 하지 않고 모달을 닫는 함수
            closeModal('modal-deleteAccount');
        }

        function deleteAccount() {
            // 체크박스가 체크되었는지 확인
            const isChecked = document.getElementById('agreeCheckbox').checked;

            if (!isChecked) {
                // 체크박스가 체크되지 않았을 때 경고 창을 띄움
                alert('회원탈퇴에 동의하지 않으면 탈퇴할 수 없습니다.');
                return; // 탈퇴 진행을 막음
            }

            // 회원 탈퇴 요청을 서버로 전송하는 함수
            // AJAX 요청을 통해 현재 로그인한 회원을 삭제
            const xhr = new XMLHttpRequest();
            xhr.open("DELETE", "/member/delete", true); // DELETE 메서드를 사용해 서버에 요청
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    console.log("회원 탈퇴 완료");
                    alert("정상적으로 탈퇴되었습니다.")
                    window.location.href = "/"; // 탈퇴 후 홈으로 리다이렉트
                } else if (xhr.readyState === 4) {
                    console.error("회원 탈퇴 중 오류 발생", xhr.responseText);
                }
            };
            xhr.send();
        }
    </script>
</div>
