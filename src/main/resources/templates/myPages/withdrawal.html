<div th:fragment="withdrawalFragment">
    <div id="modal-deleteAccount" class="mypages-modal-content">
        <h3>회원 탈퇴</h3>
        <p class="mypages-warning">정말로 회원 탈퇴를 하시겠습니까?</p>
        <p class="mypages-danger">※ 탈퇴 시 모든 정보가 삭제되며 복구할 수 없습니다.</p>
        <p class="mypages-info">회원님의 모든 데이터가 삭제되며, 탈퇴 후에는 재가입이 필요합니다.</p>
        <!-- 동의 체크박스 추가 -->
        <div>
            <input type="checkbox" id="agreeCheckbox">
            <label for="agreeCheckbox">회원탈퇴에 동의함</label>
        </div>
        <div class="mypages-button-container">
            <button class="mypages-cancelNoButton" onclick="cancelDelete()">아니오</button>
            <button id="mypages-cancelYesButton" class="mypages-cancelYesButton" onclick="deleteAccount()" disabled>예</button>
        </div>
    </div>
    <style>
        /* 모달 창 스타일 */
        .mypages-modal-content {
            font-family: 'Arial', sans-serif;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            margin: 20px auto;
            padding: 20px;
            width: 90%;
            max-width: 550px;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        /* 경고 스타일 */
        .mypages-warning {
            font-size: 18px;
            color: #333;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* 심각한 경고 스타일 */
        .mypages-danger {
            color: red;
            font-size: 16px;
            margin-bottom: 20px;
        }

        /* 추가 안내 정보 스타일 */
        .mypages-info {
            color: #555;
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* 버튼 컨테이너 스타일 */
        .mypages-button-container {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-top: 30px;
            margin-bottom: 30px;
        }

        .mypages-cancelYesButton:active {
            transform: translateY(2px);
        }

        /* 버튼 컨테이너 스타일 */
        .mypages-button-container {
            display: flex;
            justify-content: center;
            gap: 10px; /* 버튼 간의 간격을 조절 */
            margin-top: 20px;
        }

        /* 버튼 스타일 */
        .mypages-cancelNoButton,
        .mypages-cancelYesButton {
            padding: 10px 20px;
            background-color: #81c405;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .mypages-cancelNoButton:hover,
        .mypages-cancelYesButton:hover {
            background-color: #555 !important;
            opacity: 0.9;
        }

        /* 모달창 안의 텍스트 */
        .modal-content p {
            margin: 20px 0;
            word-wrap: break-word;
        }
    </style>
    <script>
        // 체크박스와 버튼 요소를 가져옴
        const agreeCheckbox = document.getElementById('agreeCheckbox');
        const cancelYesButton = document.getElementById('mypages-cancelYesButton');

        // 체크박스 상태에 따라 탈퇴 버튼 활성화/비활성화
        agreeCheckbox.addEventListener('change', function() {
            if (this.checked) {
                cancelYesButton.disabled = false; // 체크되면 탈퇴 버튼 활성화
            } else {
                cancelYesButton.disabled = true;  // 체크 해제되면 탈퇴 버튼 비활성화
            }
        });

        function cancelDelete() {
            alert('탈퇴가 취소되었습니다.');
            // 회원 탈퇴 취소 시 아무런 동작도 하지 않고 모달을 닫는 함수
            closeModal('modal-deleteAccount');
            window.location.href = "/";
        }

        function deleteAccount() {
            const isChecked = agreeCheckbox.checked; // 체크박스 상태 확인

            if (!isChecked) {
                alert('회원탈퇴에 동의하지 않으면 탈퇴할 수 없습니다.');
                return; // 탈퇴 진행을 막음
            }

            // 회원 탈퇴 요청을 서버로 전송하는 함수
            // AJAX 요청을 통해 현재 로그인한 회원을 삭제
            const xhr = new XMLHttpRequest();
            xhr.open("DELETE", "/member/delete", true); // DELETE 메서드를 사용해 서버에 요청
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    console.log("회원 탈퇴 완료");
                    alert("정상적으로 탈퇴되었습니다.")
                    window.location.href = "/"; // 탈퇴 후 홈으로 리다이렉트
                } else if (xhr.readyState === 4) {
                    console.error("회원 탈퇴 중 오류 발생", xhr.responseText);
                }
            };
            xhr.send();
        }
    </script>
</div>
