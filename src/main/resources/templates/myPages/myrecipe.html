<div th:fragment="myrecipeFragment">
    <!-- 레시피 목록을 담고 있는 외부 컨테이너 -->
    <div class="myrecipe-container">
        <!-- 각 레시피를 개별 박스로 표시 -->
        <div th:each="recipe : ${recipes}" class="myrecipe-item">
            <!-- 버튼 형태로 레시피를 클릭 가능하게 함 -->
            <button class="myrecipe-button">
                <!-- 음식 이름을 표시하는 부분 -->
                <span class="myrecipe-title" th:text="${recipe.foodName}"></span>
                <!-- 유튜브 영상이 표시될 영역 -->
                <iframe class="myrecipe-youtube-frame" data-url="${recipe.recipeUrl}" allowfullscreen></iframe>
            </button>
            <!-- 저장된 레시피 내용을 표시하는 부분 -->
            <p class="myrecipe-description" th:text="${recipe.savedRecipe}"></p>
        </div>
    </div>
</div>

<script>
    // YouTube API 키
    const apiKey = 'YOUR_YOUTUBE_API_KEY';

    // 모든 myrecipe-youtube-frame 클래스를 가진 iframe 요소를 선택하여 처리
    document.querySelectorAll('.myrecipe-youtube-frame').forEach(frame => {
        const url = frame.getAttribute('data-url'); // data-url에서 YouTube URL을 가져옴
        const videoId = getVideoIdFromUrl(url); // URL에서 동영상 ID 추출

        // YouTube Data API를 사용하여 동영상 정보를 가져옴
        fetch(`https://www.googleapis.com/youtube/v3/videos?id=${videoId}&key=${apiKey}&part=snippet`)
            .then(response => response.json())
            .then(data => {
                if (data.items.length > 0) {
                    const embedUrl = `https://www.youtube.com/embed/${videoId}`;
                    frame.setAttribute('src', embedUrl); // 추출한 embed URL을 iframe에 설정
                } else {
                    console.error('동영상을 찾을 수 없습니다.');
                }
            })
            .catch(error => console.error('API 요청 중 오류 발생:', error));
    });

    // URL에서 YouTube 동영상 ID를 추출하는 함수
    function getVideoIdFromUrl(url) {
        const urlParams = new URL(url).searchParams;
        return urlParams.get('v'); // 'v' 파라미터에서 동영상 ID 추출
    }
</script>

<style>
    .myrecipe-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }

    .myrecipe-item {
        border: 1px solid #ddd;
        padding: 20px;
        width: 300px;
        text-align: center;
    }

    .myrecipe-button {
        width: 100%;
        height: 200px;
        position: relative;
        overflow: hidden;
        cursor: pointer;
    }

    .myrecipe-title {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 20px;
        color: #fff;
        background-color: rgba(0, 0, 0, 0.6);
        padding: 10px;
        border-radius: 5px;
    }

    .myrecipe-youtube-frame {
        width: 100%;
        height: 100%;
        border: none;
    }

    .myrecipe-description {
        margin-top: 10px;
    }
</style>
