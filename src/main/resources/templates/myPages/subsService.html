<div th:fragment="subsFragment">
    <link rel="stylesheet" th:href="@{/css/subsCSS.css}">
    <div class="subscription">
        <h4>구독 시 제공할 서비스</h4>
        <ul>
            <li>광고 제거 기능</li>
            <li>식단 점수 달력 제공</li>
        </ul>
        <p class="notice-title"><strong>※ 구독 시 유의사항</strong></p>
        <p class="notice-detail">월 <span style="font-weight: bold">490원</span>으로 제공되는 구독 서비스입니다. 결제는 등록된 신용카드 또는 지정된 결제 방법을 통해 매월 자동으로 청구됩니다.</p>
        <p class="notice-detail">구독은 결제일 기준으로 월 단위로 갱신되며, 갱신 전에 언제든지 취소할 수 있습니다.</p>
        <p class="notice-detail">구독 취소 후 남은 기간에 대한 환불은 제공되지 않습니다.</p>
        <p class="notice-detail">구독 서비스는 「전자상거래 등에서의 소비자 보호에 관한 법률」에 따라 보호받습니다.</p>
        <p class="notice-detail">서비스 내용은 사전 고지 후 변경될 수 있으며, 변경된 내용은 적용 후 즉시 반영됩니다.</p>
        <p class="notice-detail">계정 및 개인정보는 관련 법령에 따라 보호되며, 계정 보안 유지에 대한 책임은 사용자 본인에게 있습니다.</p>
        <p class="notice-detail">서비스 중단 또는 종료 시 사전에 공지되며, 중단 시점까지 이용에 대한 비용은 별도로 청구되지 않습니다.</p>
        <div class="signSubsBtn">
            <input type="checkbox" id="mypagesAgreeTerms" name="mypagesAgreeTerms" />
            <label for="mypagesAgreeTerms">결제에 동의함</label>
        </div>
    </div>

    <!-- 처음에 버튼을 숨기기 위해 display: none을 적용 -->
    <div id="subBtn-container">
        <button id="mypagesSubscribeButton" onclick="subscribe()" style="display: none;">결제</button>
    </div>

    <!-- 가짜 결제 모달 창 -->
    <div id="paymentModal" class="modal-overlay">
        <div class="myrecipe-modal-content">
            <button class="close-button" onclick="closeModal()">X</button>
            <h3>가상 결제 화면</h3>
            <p>구독 서비스 결제를 진행해 주세요.</p>
            <p>결제 금액: 490원</p>
            <button id="confirmPaymentButton">결제하기</button>
        </div>
    </div>

    <style>
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .myrecipe-modal-content {
            background: white !important; /* 배경색을 흰색으로 설정 */
            color: #81C405 !important; /* 텍스트 색을 #81C405로 설정 */
            font-size: 20px;
            padding: 20px;
            border-radius: 8px;
            width: 450px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center; /* 자식 요소를 수직 가운데 정렬 */
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color : #FFB524;
        }


        #confirmPaymentButton {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #FFB524;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            align-self: center; /* 버튼을 가로 가운데 정렬 */
        }
        #confirmPaymentButton:hover{
            background-color: #81C405;

        }
    </style>

    <script>
        // 체크박스 상태 변경 시 버튼 활성화/비활성화 처리
        document.getElementById('mypagesAgreeTerms').addEventListener('change', function () {
            const isChecked = this.checked;
            const subscribeButton = document.getElementById('mypagesSubscribeButton');

            if (isChecked) {
                subscribeButton.style.display = 'flex'; // 체크박스가 선택되면 버튼을 표시
            } else {
                subscribeButton.style.display = 'none'; // 체크박스가 선택되지 않으면 버튼을 숨김
            }
        });

        // 모달 열기 함수
        function openModal() {
            document.getElementById('paymentModal').style.display = 'flex';
        }

        // 모달 닫기 함수
        function closeModal() {
            document.getElementById('paymentModal').style.display = 'none';
        }

        // 구독 버튼 클릭 시 구독 처리
        function subscribe() {
            console.log('Subscribe button clicked');
            const isAgreed = document.getElementById('mypagesAgreeTerms').checked;

            if (isAgreed) {
                console.log('Agreement checked');
                // 결제 모달 창 열기
                openModal();
            } else {
                alert('결제 동의가 필요합니다.');
            }
        }

        // 결제 모달 창의 결제 버튼 클릭 시 처리
        document.getElementById('confirmPaymentButton').addEventListener('click', function () {
            closeModal(); // 모달 닫기
            // 실제 구독 요청 처리
            fetch('/subscribe', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({}),
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                    alert('구독 완료');
                    window.location.reload(); // 페이지를 새로고침하여 구독 상태 반영
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alert('구독에 실패했습니다.');
                });
        });
    </script>
</div>
